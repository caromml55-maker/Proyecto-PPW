<main class="usuario-page">
   <header class="top-header" role="banner">
  <h2>Bienvenido a los portafolios</h2>
  <div class="header-right">
    
    <!-- Notificaciones -->
    <div class="notification-wrapper">
      <button aria-label="Ver notificaciones" class="notification-btn" (click)="toggleNotifications($event)">
        üîî
        <span class="badge" aria-live="polite" *ngIf="getNotificacionesNoLeidas() > 0">
          {{ getNotificacionesNoLeidas() > 99 ? '99+' : getNotificacionesNoLeidas() }}
        </span>
      </button>
      
      <!-- Dropdown -->
      <div class="notification-dropdown" *ngIf="showNotifications" role="dialog" aria-label="Notificaciones">
        <div class="dropdown-header">
          <h3>Notificaciones <span class="unread-count" *ngIf="getNotificacionesNoLeidas() > 0">
              ({{ getNotificacionesNoLeidas() }} nuevas)
            </span>
          </h3>
          <div class="dropdown-actions">
            <button class="btn-mark-read" (click)="marcarTodasComoLeidas()" aria-label="Marcar todas como le√≠das">‚úÖ Marcar todas</button>
          </div>
        </div>
        
        <ul class="notification-list" role="list">
          <div *ngIf="notificaciones.length === 0" class="empty-notifications">
            No hay notificaciones
          </div>
          
          <li class="notification-item" role="listitem" tabindex="0" *ngFor="let n of notificaciones; let i = index"
               [class.unread]="!n.leido" (click)="onClickNotificacion(n)"  aria-label="Notificaci√≥n: {{ n.mensaje }}. Fecha {{ n.fechaHora | date:'short' }}">
            
            <div class="notification-content">
              <!-- Indicador de no le√≠da -->
              <div class="unread-indicator" *ngIf="!n.leido"></div>
              
              <span class="notification-text">{{ n.mensaje }}</span>
            </div>
            
            <div class="notification-footer">
              <small class="notification-time">
                {{ n.fechaHora | date:'short' }}
              </small>
            </div>
          </li>
        </ul>
      </div>
    </div>
    
    <span class="username">{{ userName }}</span>
    <button class="logout-btn" (click)="logout()" aria-label="Cerrar sesi√≥n">Cerrar sesi√≥n</button>
  </div>
</header>


  <div *ngIf="!seleccionado" class="vista-programadores">

  <h3 class="title">Explorar programadores</h3>

  <div *ngIf="loading" class="select-loading-spinner">
    <div class="spinner-border spinner-border-sm text-primary" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
  </div>

    <div class="programadores-container" *ngIf="!loading">
      <div class="prog-card" *ngFor="let p of programadores">

        <img [src]="p.photoURL || 'https://ui-avatars.com/api/?name=' + p.name" class="prog-img" alt="Foto del programador {{ p.name }}"/>

        <div class="prog-name" aria-label="Nombre del programador {{ p.name }}">{{ p.name }}</div>
        <div class="prog-spec" aria-label="Especialidad {{ p.especialidad }}">{{ p.especialidad }}</div>

        <button class="btn-solicitar" (click)="verAsesoria(p)" aria-label="Solicitar asesor√≠a con {{ p.name }}">
          Solicitar asesor√≠a
        </button>

      </div>
    </div>

  </div>

  <div *ngIf="seleccionado" class="vista-asesoria">

    <div class="asesoria-header">
      <h3>Asesor√≠a con {{ seleccionado.name }}</h3>
      <button class="btn-inicio" (click)="volver()" aria-label="inicio" >üè† Inicio</button>
    </div>

    <p class="disponible">Horarios disponibles</p>

    <div class="calendar-box" *ngIf="calendarReady" role="region" aria-label="Calendario de disponibilidad"> <full-calendar [options]="calendarOptions">
      </full-calendar>
    </div>


    <textarea placeholder="Comentario opcional" [(ngModel)]="comentario" aria-label="Comentario opcional"></textarea>

    <div class="accion-asesoria">
      <button class="btn-agendar" [disabled]="!selectedEventId"  (click)="agendarAsesoria()" aria-label="Agendar asesor√≠a">Agendar asesor√≠a</button>

      <button class="btn-cancelar" (click)="volver()"  aria-label="Cancelar">Cancelar</button>
    </div>
  </div>

</main>
