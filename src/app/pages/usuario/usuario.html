<main class="usuario-page">
   <header class="top-header" role="banner">
  <h2>Bienvenido a los portafolios</h2>
  <div class="header-right">
    
    <!-- Notificaciones -->
    <div class="notification-wrapper">
      <button aria-label="Ver notificaciones" class="notification-btn" (click)="toggleNotifications($event)">
        ðŸ””
        <span class="badge" aria-live="polite" *ngIf="getNotificacionesNoLeidas() > 0">
          {{ getNotificacionesNoLeidas() > 99 ? '99+' : getNotificacionesNoLeidas() }}
        </span>
      </button>
      
      <!-- Dropdown -->
      <div class="notification-dropdown" *ngIf="showNotifications" role="dialog" aria-label="Notificaciones">
        <div class="dropdown-header">
          <h3>Notificaciones <span class="unread-count" *ngIf="getNotificacionesNoLeidas() > 0">
              ({{ getNotificacionesNoLeidas() }} nuevas)
            </span>
          </h3>
          <div class="dropdown-actions">
            <button class="btn-mark-read" (click)="marcarTodasComoLeidas()" aria-label="Marcar todas como leÃ­das">âœ… Marcar todas</button>
          </div>
        </div>
        
        <ul class="notification-list" role="list">
          <div *ngIf="notificaciones.length === 0" class="empty-notifications">
            No hay notificaciones
          </div>
          
          <li class="notification-item" role="listitem" tabindex="0" *ngFor="let n of notificaciones; let i = index"
               [class.unread]="!n.leido" (click)="onClickNotificacion(n)"  aria-label="NotificaciÃ³n: {{ n.mensaje }}. Fecha {{ n.fechaHora | date:'short' }}">
            
            <div class="notification-content">
              <!-- Indicador de no leÃ­da -->
              <div class="unread-indicator" *ngIf="!n.leido"></div>
              
              <span class="notification-text">{{ n.mensaje }}</span>
            </div>
            
            <div class="notification-footer">
              <small class="notification-time">
                {{ n.fechaHora | date:'short' }}
              </small>
            </div>
          </li>
        </ul>
      </div>
    </div>
    
    <span class="username">{{ userName }}</span>
    <button class="logout-btn" (click)="logout()" aria-label="Cerrar sesiÃ³n">Cerrar sesiÃ³n</button>
  </div>
</header>


  <div *ngIf="!seleccionado && !viendoPortafolios" class="vista-programadores">


  <h3 class="title">Explorar programadores</h3>

  <div *ngIf="loading" class="select-loading-spinner">
    <div class="spinner-border spinner-border-sm text-primary" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
  </div>

    <div class="programadores-container" *ngIf="!loading">
      <div class="prog-card" *ngFor="let p of programadores">

        <img [src]="p.photoURL || 'https://ui-avatars.com/api/?name=' + p.name" class="prog-img" alt="Foto del programador {{ p.name }}"/>

        <div class="prog-name" aria-label="Nombre del programador {{ p.name }}">{{ p.name }}</div>
        <div class="prog-spec" aria-label="Especialidad {{ p.especialidad }}">{{ p.especialidad }}</div>

        <button class="btn-solicitar" (click)="verAsesoria(p)" aria-label="Solicitar asesorÃ­a con {{ p.name }}"> Solicitar asesorÃ­a</button>
        <button class="btn-portafolios" (click)="verPortafolios(p)" aria-label="Ver portafolios del programador {{ p.name }}"> Ver portafolios </button>
      </div>
    </div>

  </div>

  <div *ngIf="seleccionado && !viendoPortafolios" class="vista-asesoria">

    <div class="asesoria-header">
      <h3>AsesorÃ­a con {{ seleccionado.name }}</h3>
      <button class="btn-inicio" (click)="volver()" aria-label="inicio" >Inicio</button>
    </div>

    <p class="disponible">Horarios disponibles</p>

    <div class="calendar-box" *ngIf="calendarReady" role="region" aria-label="Calendario de disponibilidad"> <full-calendar [options]="calendarOptions">
      </full-calendar>
    </div>


    <textarea placeholder="Comentario opcional" [(ngModel)]="comentario" aria-label="Comentario opcional"></textarea>

    <div class="accion-asesoria">
      <button class="btn-agendar" [disabled]="!selectedEventId"  (click)="agendarAsesoria()" aria-label="Agendar asesorÃ­a">Agendar asesorÃ­a</button>

      <button class="btn-cancelar" (click)="volver()"  aria-label="Cancelar">Cancelar</button>
    </div>
  </div>

            <!--     PORTAFOLIOS PROGRAMADOR     -->
            <!-- =============================== -->

  <div *ngIf="!loadingPortafolios && viendoPortafolios" class="vista-portafolios">

  <header class="portafolio-header" role="heading" aria-level="2">
      <h2>Portafolios de {{ seleccionado.name }}</h2>

      <button class="btn-cerrar" (click)="cerrarPortafolios()" aria-label="Cerrar portafolios y volver">Inicio </button>
  </header>

  <p class="sub-info" aria-live="polite">
     Total de proyectos: {{ (portafoliosAcademicos.length || 0) + (portafoliosLaborales.length || 0) }}
  </p>



  <!-- =============================== -->
  <!--          ACADÃ‰MICOS            -->
  <!-- =============================== -->
  <section *ngIf="portafoliosAcademicos.length > 0"
           class="categoria"
           role="region"
           aria-labelledby="titulo-acad">

      <h3 id="titulo-acad">Proyectos AcadÃ©micos</h3>

      <div class="lista-portafolios">
          <article class="port-card"
                   *ngFor="let item of portafoliosAcademicos"
                   role="article">

              <h4>{{ item.nombre }}</h4>

              <p><strong>Tipo:</strong> {{ item.tipo }}</p>

              <p><strong>TecnologÃ­as:</strong> {{ item.tecnologias }}</p>

              <p class="descripcion">{{ item.descripcion }}</p>

              <a *ngIf="item.urlRepositorio"
                 class="enlace-repo"
                 [href]="item.urlRepositorio"
                 target="_blank"
                 aria-label="Abrir repositorio en nueva pestaÃ±a">
                  ðŸ”— Ver repositorio
              </a>
          </article>
      </div>
  </section>



  <!-- =============================== -->
  <!--          LABORALES             -->
  <!-- =============================== -->
  <section *ngIf="portafoliosLaborales.length > 0"
           class="categoria"
           role="region"
           aria-labelledby="titulo-lab">

      <h3 id="titulo-lab">Proyectos Laborales</h3>

      <div class="lista-portafolios">

          <article class="port-card"
                   *ngFor="let item of portafoliosLaborales"
                   role="article">

              <h4>{{ item.nombre }}</h4>

              <p><strong>Tipo:</strong> {{ item.tipo }}</p>

              <p><strong>TecnologÃ­as:</strong> {{ item.tecnologias }}</p>

              <p class="descripcion">{{ item.descripcion }}</p>

              <a *ngIf="item.urlRepositorio"
                 class="enlace-repo"
                 [href]="item.urlRepositorio"
                 target="_blank"
                 aria-label="Abrir repositorio laboral en nueva pestaÃ±a">
                  ðŸ”— Ver repositorio
              </a>
          </article>

      </div>
  </section>



  <!-- NINGUN PORTAFOLIO -->
  <p *ngIf="(portafoliosAcademicos.length||0) ===0 && (portafoliosLaborales.length||0) ===0"
     class="no-port"
     role="alert">
      No hay portafolios registrados.
  </p>

</div>

<!-- CARGANDO PORTAFOLIOS -->
  <p *ngIf="loadingPortafolios" class="no-port" role="alert">
    Cargando...
  </p>
</main>