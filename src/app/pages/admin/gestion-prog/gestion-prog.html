<div class="admin-page">
  <header class="admin-header">
    <div class="header-content">
      <h1>Gesti√≥n de Programadores</h1>
      <div class="header-actions">
        <button class="btn btn-secondary" (click)="goToInicio()">üè† Inicio</button>
        <!-- BOT√ìN QUE ACTIVA MODO AGREGAR -->
        <button class="btn btn-primary" (click)="initCreateMode()">
          + Agregar Programador
        </button>
        <button class="btn btn-secondary" (click)="logout()">Cerrar Sesi√≥n</button>
      </div>
    </div>
  </header>

  <div class="admin-content">

    <!-- ======================================================= -->
    <!-- PARTE 1: SELECCI√ìN Y DETALLE (Solo si NO estamos creando) -->
    <!-- ======================================================= -->
    @if (!isCreating) {
      <div class="view-section">
        
        <!-- COMBOBOX (Solo aparece aqu√≠) -->
        <div class="selector-container">
          <label for="selector">Seleccionar programador:</label>
          <select id="selector" [(ngModel)]="selectedUid" (change)="onProgramadorSelected($event)" [disabled]="loading" class="form-select">
            <option value="null" selected>-- Selecciona de la lista --</option>
            @for (p of programadores; track p.uid) {
              <option [value]="p.uid">{{ p.name }} ({{ p.email }})</option>
            }
          </select>

          <div *ngIf="loading" class="select-loading-spinner">
            <div class="spinner-border spinner-border-sm text-primary" role="status">
              <span class="visually-hidden">Cargando...</span>
            </div>
          </div>

          <!-- Error message -->
          <div *ngIf="errorMsg" class="alert alert-danger mt-2">
            {{ errorMsg }}
          </div>
        </div>

        <!-- TARJETA DE INFORMACI√ìN (Aparece al seleccionar) -->
        @if (selectedProgramador) {
          <div class="card-detail">
            
            <!-- 1. FOTO AL INICIO (Requisito cumplido) -->
            <div class="photo-center">
              @if (formData.photoURL) {
                <img [src]="formData.photoURL" class="profile-img-lg" alt="Foto">
              } @else {
                <div class="no-photo-placeholder">Sin Foto</div>
              }
            </div>

            <!-- 2. CAMPOS DE DATOS -->
            <div class="form-grid">
              <div class="form-group">
                <label>Nombre</label>
                <input type="text" [(ngModel)]="formData.name" [disabled]="!isEditing">
              </div>
              <div class="form-group">
                <label>Email</label>
                <input type="email" [(ngModel)]="formData.email" [disabled]="!isEditing">
              </div>
              <div class="form-group">
                <label>Especialidad</label>
                <input type="text" [(ngModel)]="formData.especialidad" [disabled]="!isEditing">
              </div>
              <div class="form-group">
                <label>Rol</label>
                <input type="text" [(ngModel)]="formData.role" [disabled]="!isEditing"> 
              </div>
              <div class="form-group">
                <label>Contacto</label>
                <input type="text" [(ngModel)]="formData.telefono" [disabled]="!isEditing" placeholder="099 999 9999">
              </div>

              <!-- REDES SOCIALES -->
              <div class="form-group full-row">
                <label class="section-label">Redes Sociales</label>
                <div class="social-inputs">
                  <input type="text" [(ngModel)]="formData.redesSociales.github" [disabled]="!isEditing" placeholder="GitHub URL">
                  <input type="text" [(ngModel)]="formData.redesSociales.linkedin" [disabled]="!isEditing" placeholder="LinkedIn URL">
                  <input type="text" [(ngModel)]="formData.redesSociales.portfolio" [disabled]="!isEditing" placeholder="Portfolio URL">
                </div>
              </div>

              <!-- 3. DESCRIPCI√ìN AL FINAL (Requisito cumplido) -->
              <div class="form-group full-row">
                <label>Descripci√≥n Profesional</label>
                <textarea rows="4" [(ngModel)]="formData.descripcion" [disabled]="!isEditing"></textarea>
              </div>
            </div>

            <!-- 4. BOTONES DE ACCI√ìN -->
            <div class="action-buttons">
              @if (!isEditing) {
                <!-- MODO LECTURA: Ver Editar/Eliminar -->
                <button class="btn btn-warning" (click)="enableEditMode()">‚úèÔ∏è Editar</button>
                <button class="btn btn-danger" (click)="deleteProgramador()">üóëÔ∏è Eliminar</button>
              } @else {
                <!-- MODO EDICI√ìN: Ver Guardar/Cancelar -->
                <button class="btn btn-success" (click)="saveProgramador()">üíæ Guardar Cambios</button>
                <button class="btn btn-secondary" (click)="cancelAction()">Cancelar</button>
              }
            </div>
          </div>
        }
      </div>
    }

    <!-- ======================================================= -->
    <!-- PARTE 2: AGREGAR PROGRAMADOR (Solo si isCreating es TRUE) -->
    <!-- ======================================================= -->
    @if (isCreating) {
      <div class="create-section">
        <h2>Agregar Nuevo Programador</h2>
        

        <div class="form-grid">
          <div class="form-group">
            <label>Nombre *</label>
            <input type="text" [(ngModel)]="formData.name">
          </div>
          <div class="form-group">
            <label>Email *</label>
            <input type="email" [(ngModel)]="formData.email">
          </div>
          <div class="form-group">
            <label>Especialidad</label>
            <input type="text" [(ngModel)]="formData.especialidad">
          </div>
          <div class="form-group">
            <label>Contacto</label>
            <input type="text" [(ngModel)]="formData.telefono" placeholder="099 999 9999">
          </div>

          <div class="form-group full-row">
            <label class="section-label">Redes Sociales</label>
            <div class="social-inputs">
              <input type="text" [(ngModel)]="formData.redesSociales.github" placeholder="GitHub URL">
              <input type="text" [(ngModel)]="formData.redesSociales.linkedin" placeholder="LinkedIn URL">
              <input type="text" [(ngModel)]="formData.redesSociales.portfolio" placeholder="Portfolio URL">
            </div>
          </div>

          <!-- DESCRIPCI√ìN AL FINAL -->
          <div class="form-group full-row">
            <label>Descripci√≥n Profesional</label>
            <textarea rows="4" [(ngModel)]="formData.descripcion"></textarea>
          </div>
        </div>

        <div class="action-buttons">
          <!-- BOT√ìN GUARDAR VISIBLE -->
          <button class="btn btn-success" (click)="saveProgramador()">‚úÖ Guardar Programador</button>
          <button class="btn btn-secondary" (click)="cancelAction()">Cancelar</button>
        </div>
      </div>
    }

  </div>
</div>