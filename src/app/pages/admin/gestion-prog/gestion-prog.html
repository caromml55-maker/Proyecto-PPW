<main class="admin-page" role="main">
  <header class="admin-header" role="banner">
    <div class="header-content">
      <h1>Gesti√≥n de Programadores</h1>
      <div class="header-actions">
        <button class="btn btn-primary" (click)="initCreateMode()" aria-label="Agregar programador">+ Agregar Programador</button>
        <button class="btn btn-secondary" (click)="goToInicio()" aria-label="Ir al inicio">Inicio</button>
      </div>
    </div>
  </header>

  <div class="admin-content">

    @if (!isCreating) {
    <div class="view-section">
        
      <!-- COMBOBOX (Solo aparece aqu√≠) -->
      <div class="selector-container">
        <h2 class="selector-title">Seleccionar usuarios del sistema</h2>

        <div class="selector-grid">

          <!-- PROGRAMADORES (ya existente, con l√≥gica de edici√≥n) -->
          <div class="selector-block">
            <label for="selectProgramador">Programadores</label>
            <select id="selectProgramador" [(ngModel)]="selectedProgramador"
              (change)="onProgramadorSelected($event)"
              [disabled]="loading"
              class="form-select">
              <option value="" selected disabled>-- Seleccionar programador --</option>
              <option *ngFor="let p of programadores" [value]="p.uid">
                {{ p.displayName || p.name }} ({{ p.email }})
              </option>
            </select>
          </div>

          <!-- ADMINISTRADORES (solo visual, sin l√≥gica extra) -->
          <div class="selector-block">
            <label for="selectProgramador">Administradores</label>
            <select id="selectProgramador" [(ngModel)]="selectedAdmin"
              (change)="onAdminSelected($event)"
              [disabled]="loading"
              class="form-select">
              
              <option value="" selected disabled>-- Seleccionar administrador --</option>
              <option *ngFor="let a of admins" [value]="a.uid">
                {{ a.displayName || a.name }} ({{ a.email }})
              </option>
            </select>
          </div>

          <!-- USUARIOS NORMALES (solo visual) -->
          <div class="selector-block">
            <label for="selectProgramador">Usuarios</label>
            <select id="selectProgramador" [(ngModel)]="selectedUsuario"
              (change)="onUsuarioSelected($event)"
              [disabled]="loading"
              class="form-select">
              
              <option value="" selected disabled>-- Seleccionar usuario --</option>
              <option *ngFor="let u of usuarios" [value]="u.uid">
                {{ u.displayName || u.name }} ({{ u.email }})
              </option>
            </select>
          </div>
        </div>

        <div *ngIf="loading" class="select-loading-spinner">
          <div class="spinner-border spinner-border-sm text-primary" role="status">
            <span class="visually-hidden">Cargando...</span>
          </div>
        </div>

        <!-- Error message -->
        <div *ngIf="errorMsg" class="alert alert-danger mt-2">
          {{ errorMsg }}
        </div>
      </div>


      <!-- TARJETA DE INFORMACI√ìN (Aparece al seleccionar) -->
      @if (selectedUser) {
        <div class="card-detail">
          <!-- 1. FOTO AL INICIO (Requisito cumplido) -->
          <div class="photo-center">
            @if (formData.photoURL) {
              <img [src]="formData.photoURL" class="profile-img-lg" alt="Foto del programador">
            } @else {
              <div class="no-photo-placeholder">Sin Foto</div>
            }
          </div>
          
          <!-- 2. CAMPOS DE DATOS -->
          <div class="form-grid">
            <div class="form-group">
              <label>Nombre</label>
              <input type="text" [(ngModel)]="formData.name" [disabled]="!isEditing" aria-label="Nombre del usuario">
            </div>
            
            <div class="form-group">
              <label>Email</label>
              <input type="email" [(ngModel)]="formData.email" [disabled]="!isEditing" aria-label="email">
            </div>
            
            <div class="form-group">
              <label>Especialidad</label>
              <input type="text" [(ngModel)]="formData.especialidad" [disabled]="!isEditing" aria-label="especialidad">
            </div>
            
            <div class="form-group">
              <label>Rol</label>
              <input type="text" [(ngModel)]="formData.role" [disabled]="!isEditing" aria-label="rol">
            </div>
            
            <div class="form-group">
              <label>Contacto</label>
              <input type="text" [(ngModel)]="formData.telefono" [disabled]="!isEditing" placeholder="099 999 9999" aria-label="contacto">
            </div>
            
            <!-- REDES SOCIALES -->
            <div class="form-group full-row">
              <label class="section-label">Redes Sociales</label>
              <div class="social-inputs">
                <input type="text" [(ngModel)]="formData.redesSociales.github" [disabled]="!isEditing" placeholder="GitHub URL" aria-label="github">
                <input type="text" [(ngModel)]="formData.redesSociales.linkedin" [disabled]="!isEditing" placeholder="LinkedIn URL" aria-label="linkedin">
                <input type="text" [(ngModel)]="formData.redesSociales.portfolio" [disabled]="!isEditing" placeholder="portafolios">
              </div>
            </div>
            
            <!-- 3. DESCRIPCI√ìN AL FINAL (Requisito cumplido) -->
            <div class="form-group full-row">
              <label>Descripci√≥n Profesional</label>
              <textarea rows="4" [(ngModel)]="formData.descripcion" [disabled]="!isEditing"></textarea>
            </div>
          </div>
          
          <!-- 4. BOTONES DE ACCI√ìN -->
          <div class="action-buttons">
            @if (!isEditing) {
              <!-- MODO LECTURA: Ver Editar/Eliminar -->
              <button class="btn btn-warning" (click)="enableEditMode()" aria-label="Editar informaci√≥n">‚úèÔ∏è Editar</button>
              <button class="btn btn-danger" (click)="deleteProgramador()" aria-label="Eliminar usuario">üóëÔ∏è Eliminar</button>
            } @else {
              <!-- MODO EDICI√ìN: Ver Guardar/Cancelar -->
              <button class="btn btn-success" (click)="saveUser()" aria-label="guardar usuario">üíæ Guardar Cambios</button>
              <button class="btn btn-secondary" (click)="cancelAction()" aria-label="cancelar accion">Cancelar</button>
            }
          </div>
        </div>
        }
      </div>
      }

      <!-- ======================================================= -->
      <!-- PARTE 2: AGREGAR PROGRAMADOR (Solo si isCreating es TRUE) -->
      <!-- ======================================================= -->
      @if (isCreating) {
        <div class="create-section">
          <h2>Agregar Nuevo Programador</h2>
          

          <div class="form-grid">
            <div class="form-group">
              <label>Nombre *</label>
              <input type="text" [(ngModel)]="formData.name">
            </div>
            <div class="form-group">
              <label>Email *</label>
              <input type="email" [(ngModel)]="formData.email">
            </div>
            <div class="form-group">
              <label>Especialidad</label>
              <input type="text" [(ngModel)]="formData.especialidad">
            </div>
            <div class="form-group">
              <label>Contacto</label>
              <input type="text" [(ngModel)]="formData.telefono" placeholder="099 999 9999">
            </div>

            <div class="form-group full-row">
              <label class="section-label">Redes Sociales</label>
              <div class="social-inputs">
                <input type="text" [(ngModel)]="formData.redesSociales.github" placeholder="GitHub URL">
                <input type="text" [(ngModel)]="formData.redesSociales.linkedin" placeholder="LinkedIn URL">
                <input type="text" [(ngModel)]="formData.redesSociales.portfolio" placeholder="Portfolio URL">
              </div>
            </div>

            <!-- DESCRIPCI√ìN AL FINAL -->
            <div class="form-group full-row">
              <label>Descripci√≥n Profesional</label>
              <textarea rows="4" [(ngModel)]="formData.descripcion"></textarea>
            </div>
          </div>

          <div class="action-buttons">
            <!-- BOT√ìN GUARDAR VISIBLE -->
            <button class="btn btn-success" (click)="saveUser()">‚úÖ Guardar Programador</button>
            <button class="btn btn-secondary" (click)="cancelAction()">Cancelar</button>
          </div>
        </div>
      }
  </div>
</main>
